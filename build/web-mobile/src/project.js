require=function c(i,a,s){function l(e,t){if(!a[e]){if(!i[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(u)return u(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var n=a[e]={exports:{}};i[e][0].call(n.exports,function(t){return l(i[e][1][t]||t)},n,n.exports,c,i,a,s)}return a[e].exports}for(var u="function"==typeof require&&require,t=0;t<s.length;t++)l(s[t]);return l}({AnimationMediator:[function(t,e,o){"use strict";cc._RF.push(e,"5faecb4HlZD251MisyYcR0X","AnimationMediator");var u=t("MathVec"),r={backgroundLoop:function(t,e,o,r){var n=void 0===r?1:r;t.x>-e?(t.x-=n,t.y-="toLeft"===o?0:n):t.setPosition(0,0)},moveFollowTarget:function(t,e,o){var r=void 0===o?1:o,n=u.getFront(t,e);t.setPosition(t.x+n.x*r,t.y+n.y*r)},fireOnce:function(t,e,o,r,n){t.runAction(cc.moveTo(2*r,u.getPos(o,e))),n.scheduleOnce(function(){t.destroy()},2*r)},fireToTargetOnce:function(t,e,o,r){o.parent.convertToWorldSpace(o.position);t.runAction(cc.moveTo(2*e,cc.v2(o.x,o.y))),r.scheduleOnce(function(){t.destroy()},2*e)},randColor:function(){var t=200*cc.random0To1(),e=200*cc.random0To1(),o=200*cc.random0To1();return cc.color(t,e,o)},faceToTarget:function(t,e){r.rotateToTarget(t,e)},faceToNearestTarget:function(t,e){this.faceToTarget(t,this.getNearestTarget(t,e))},getNearestTarget:function(t,e){var o=[],r=!0,n=!1,c=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;o.push(parseInt(u.getDistance(t,s)))}}catch(t){n=!0,c=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw c}}var l=u.getMinFromVector(o);if(0<e.length)return e[u.getOrderFromVector(l,o)]},rotateToTarget:function(t,e){t.rotation=-u.transformAngle(u.getAngle(u.getFront(t,e)))},followRotate:function(t,e){t.rotation=e.rotation},faceTargetToX:function(t,e,o){0<t.x-o.x?e.runAction(cc.flipX(!0)):e.runAction(cc.flipX(!1))},faceTargetByAngle:function(t,e){90<Math.abs(t)?e.runAction(cc.flipX(!0)):e.runAction(cc.flipX(!1))}};e.exports=r,cc._RF.pop()},{MathVec:"MathVec"}],BarManager:[function(t,e,o){"use strict";cc._RF.push(e,"58f7au2jaxKyoSnWV+IEHb1","BarManager");var r={add:null,reduce:null,reduceSpeed:.03,bar:null,that:null,initBar:function(t,e){this.bar=t,this.bar.progress=0,this.that=e},initPowerBtn:function(t){t.node.on("touchstart",this.addBarSch,this.that),t.node.on("touchend",this.reduceBarSch,this.that),t.node.on("touchcancel",this.reduceBarSch,this.that)},pro1:{value:.3,color:cc.Color.GREEN,speed:.01},pro2:{value:.7,color:cc.Color.YELLOW,speed:.003},pro3:{value:.99,color:cc.Color.BLUE,speed:.001},pro4:{color:cc.Color.BLACK},testPro:function(t,e){return t.progress<e.value},colorBar:function(){var t=this.bar;this.testPro(t,this.pro1)?t.barSprite.node.color=this.pro1.color:this.testPro(t,this.pro2)?t.barSprite.node.color=this.pro2.color:this.testPro(t,this.pro3)?t.barSprite.node.color=this.pro3.color:t.barSprite.node.color=this.pro4.color},addPower:function(){var t=this.bar;this.testPro(t,this.pro1)?t.progress+=this.pro1.speed:this.testPro(t,this.pro2)?t.progress+=this.pro2.speed:this.testPro(t,this.pro3)?t.progress+=this.pro3.speed:t.progress=1,this.colorBar(t)},reducePower:function(){var t=this.bar;.1<t.progress?t.progress-=this.reduceSpeed:t.progress=0,this.colorBar(t)},addBarSch:function(){var t=this.bar;r.that.unschedule(this.reduce),r.that.schedule(this.add=function(){r.addPower(t)},.01)},reduceBarSch:function(){var t=this.bar;r.that.unschedule(this.add),r.that.schedule(this.reduce=function(){r.reducePower(t)},.01)},getColorFromBar:function(t){return t.barSprite.node.color}};e.exports=r,cc._RF.pop()},{}],CollisionManager:[function(t,e,o){"use strict";cc._RF.push(e,"ea04c87alxNy6a77fpFvYny","CollisionManager");var r=t("MathVec"),n={testPos:function(t,e,o){return r.getDistance(t,e)<o}};e.exports=n,cc._RF.pop()},{MathVec:"MathVec"}],EnemyFactory:[function(t,e,o){"use strict";cc._RF.push(e,"0fb64MfKrFPBa4mdJmb5Mv/","EnemyFactory");var a=t("AnimationMediator"),r=(t("GlobalData"),t("MathVec")),s={enemySpriteList:null,enemyType:null,enemyPool:null,bulletType:null,bulletPool:null,that:null,initSource:function(t,e,o,r){this.that=o,this.enemySpriteList=r,this.enemyType=t,this.bulletType=e,this.enemyPool=new cc.NodePool,this.bulletPool=new cc.NodePool;for(var n=0;n<5;++n){var c=cc.instantiate(t);c.getChildByName("spr").getComponent(cc.Sprite).spriteFrame=s.getRandSpriteFrame(),this.enemyPool.put(c);var i=cc.instantiate(e);i.color=a.randColor(),this.bulletPool.put(i)}},createAmary:function(t,e){var o="undefined"===e?cc.p(100,100):e,r=this.getTypeNodeFromPool(this.enemyType,this.enemyPool);return r.parent=t,r.position=o,r},createBullet:function(t,e){var o=s.getTypeNodeFromPool(this.bulletType,this.bulletPool);return o.parent=e,o.setPosition(e.convertToNodeSpace(t.position)),a.fireOnce(o,100,t.rotation,1,this.that),o},createBulletToEnemy:function(t,e,o){var r=this.getTypeNodeFromPool(this.bulletType,this.bulletPool);return r.parent=e,r.setPosition(e.convertToNodeSpace(t.position)),a.fireToTargetOnce(r,.1,a.getNearestTarget(t,o),this.that),r},getTypeNodeFromPool:function(t,e){return 0<e.size()?e.get():cc.instantiate(t)},getRandSpriteFrame:function(){return r.getRandElem(s.enemySpriteList)},createAmaryInVectorAuto:function(t,e,o){t.length<1&&t.push(s.createAmary(e,o))}};e.exports=s,cc._RF.pop()},{AnimationMediator:"AnimationMediator",GlobalData:"GlobalData",MathVec:"MathVec"}],GlobalData:[function(t,e,o){"use strict";cc._RF.push(e,"81343kHnX9MZbUxuYQQw7mL","GlobalData");e.exports={enemyVector:null,enemySprite:[],bulletVector:null,score:null,scoreVector:[]},cc._RF.pop()},{}],JsTool:[function(t,e,o){"use strict";cc._RF.push(e,"c37a4VnHgRDF4fVamaoqiep","JsTool");var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};window.JsTool={obj2string:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(t){var e=[];if("string"==typeof t)return'"'+t.replace(/([\'\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+'"';if("object"===(void 0===t?"undefined":r(t))){if(t.sort){for(o=0;o<t.length;o++)e.push(obj2string(t[o]));e="["+e.join()+"]"}else{for(var o in t)e.push(o+":"+this.obj2string(t[o]));document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(t.toString)&&e.push("toString:"+t.toString.toString()),e="{"+e.join()+"}"}return e}return t.toString()}),writeObj:function(t){var e="";for(var o in t){e+=o+" = "+t[o]+"\n"}console.log(e)}},cc._RF.pop()},{}],MathVec:[function(t,e,o){"use strict";cc._RF.push(e,"d2c3ak2T4JMyqLgjCrvpsNy","MathVec");var r={limitToCircle:function(t,e){return this.getLength(t)<e?t:this.getPos(this.getAngle(t),e)},limitToRect:function(t,e,o){return cc.v2(this.limitToWall(t.x,e),this.limitToWall(t.y,o))},limitToWall:function(t,e){return Math.abs(t)<e?t:0<t?e:-e},getAngle:function(t){return 0<t.y?Math.acos(t.x/t.mag()):-Math.acos(t.x/t.mag())},transformAngle:function(t){return 180*t/Math.PI},getPos:function(t,e){return cc.v2(e*Math.cos(t),e*Math.sin(t))},getLength:function(t){return t.mag()},getRandNum:function(t,e){return"x"===e?cc.v2(t.x*cc.random0To1(),t.y):cc.v2(t.x,t.y*cc.random0To1())},getRandPos:function(t,e){return cc.v2(t.x*cc.random0To1()+e.x,t.y*cc.random0To1()+e.y)},getFront:function(t,e){var o=cc.v2(e.x-t.x,e.y-t.y);return cc.v2(o.x/o.mag(),o.y/o.mag())},getDistance:function(t,e){return cc.v2(e.x-t.x,e.y-t.y).mag()},transformToParentWorld:function(t){return cc.v2(t.parent.x+t.x,t.parent.y+t.y)},getMaxFromVector:function(t){return Math.max.apply(null,t)},getMinFromVector:function(t){return Math.min.apply(null,t)},getOrderFromVector:function(t,e){for(var o=0;o<e.length;o++)if(t===e[o])return o},getPosNegative:function(t){return cc.v2(-t.x,-t.y)},addTwoPos:function(t,e,o){return cc.p(t.x+e.x,t.y+e.y)},getRandElem:function(t){return t[parseInt(t.length*cc.random0To1())]}};e.exports=r,cc._RF.pop()},{}],MoveCtrllor:[function(t,e,o){"use strict";cc._RF.push(e,"763dc39VJZILq/I9U0Mwt1s","MoveCtrllor");var c=t("MathVec"),r={angle:null,force:null,status:null,heroSpeed:null,radius:null,lastAngle:null,onload:function(t){this.lastAngle=this.angle,this.angle=0,this.force=0,this.status=!1,t.node.setPosition(0,0)},init:function(r,n,t,e){this.radius=void 0===t?25:t,this.heroSpeed=void 0===e?5:e,r.node.on("touchstart",function(t){this.status=!0},this),r.node.on("touchmove",function(t){var e=r.node.convertToNodeSpaceAR(t.getLocation()),o=c.limitToCircle(e,this.radius);n.node.setPosition(o),this.angle=c.getAngle(o),this.force=c.getLength(o)/this.radius},this),r.node.on("touchend",function(t){this.onload(n)},this),r.node.on("touchcancel",function(t){this.onload(n)},this)},getMoveAngle:function(){return this.angle},getLastAngle:function(){return this.lastAngle},getForce:function(){return this.force},getStatus:function(){return this.status},updateCharacter:function(t){this.directToDes(t,"character")},updateCamera:function(t){this.directToDes(t,"camera")},directToDes:function(t,e){if(!0===this.getStatus()){var o=this.getMoveAngle(),r=this.getForce(),n="character"===e?cc.p(t.x+this.heroSpeed*Math.cos(o)*r,t.y+this.heroSpeed*Math.sin(o)*r):"camera"===e?cc.p(t.x-this.heroSpeed*Math.cos(o)*r,t.y-this.heroSpeed*Math.sin(o)*r):console.log("methodError");t.runAction(cc.moveTo(.1,cc.v2(c.limitToRect(n,495,158.4))))}}};e.exports=r,cc._RF.pop()},{MathVec:"MathVec"}],OverScene:[function(t,e,o){"use strict";cc._RF.push(e,"29194r7yDVFR7LWiLOoJhxo","OverScene");var r=t("GlobalData"),n=t("AnimationMediator");cc.Class({extends:cc.Component,properties:{restartBtn:cc.Button,scoreLabel:cc.Label,list:cc.Label,backgroundSpr:cc.Sprite,audio:cc.AudioClip},onLoad:function(){this.scoreLabel.string=r.score,r.scoreVector.push(this.scoreLabel.string),this.list.string=Math.max.apply(null,r.scoreVector)},start:function(){this.restartBtn.node.on("click",function(){this.current=cc.audioEngine.play(this.audio,!1,1),cc.director.loadScene("PlayScene")},this)},update:function(t){n.backgroundLoop(this.backgroundSpr.node,64)}}),cc._RF.pop()},{AnimationMediator:"AnimationMediator",GlobalData:"GlobalData"}],PlayScene:[function(t,e,o){"use strict";cc._RF.push(e,"4fe5ezPc4ZICqjhyupIpGWo","PlayScene");t("SceneMediator");var b=t("MoveCtrllor"),S=(t("BarManager"),t("EnemyFactory")),v=t("AnimationMediator"),M=t("GlobalData"),T=t("MathVec"),L=t("CollisionManager");cc.Class({extends:cc.Component,properties:{PlayScene:cc.Node,audio:cc.AudioClip,backgroundLayer:cc.Node,noticeLabel:cc.Label,scoreLabel:cc.Label,timeLabel:cc.Label,heroBloodLabel:cc.Label,bulletLabel:cc.Label,levelLabel:cc.Label,backBtn:cc.Button,basic:cc.Sprite,touch:cc.Sprite,powerBtn:cc.Button,hero:cc.Node,heroBlood:cc.ProgressBar,powerBar:cc.ProgressBar,weapon:cc.Node,enemyBar:cc.ProgressBar,enemySpriteList:{default:[],type:[cc.SpriteFrame]},enemyType:cc.Node,bulletType:cc.Node},enemyLock:null,enemySpeed:null,timeStep:null,bulletNum:null,onLoad:function(){this.bulletNum=20,this.timeLabel.string=0,this.timeStep=10,this.timeLabel.string+=this.timeStep,this.bulletLabel.string=this.bulletNum,this.levelLabel.string=1,this.scoreLabel.string=0,this.heroBlood.progress=1,this.powerBar.progress=1,this.enemySpeed=.5,this.enemyLock=!1,M.enemyVector=[],M.bulletVector=[],b.init(this.basic,this.touch),S.initSource(this.enemyType,this.bulletType,this,this.enemySpriteList)},start:function(){this.backBtn.node.on("click",function(){this.current=cc.audioEngine.play(this.audio,!1,1),cc.director.loadScene("StartScene")},this),this.powerBtn.node.on("click",function(){if(0<M.enemyVector.length)var t=S.createBulletToEnemy(this.weapon,this.backgroundLayer,M.enemyVector);else t=S.createBullet(this.weapon,this.backgroundLayer);this.powerBar.progress-=1/this.bulletNum,M.bulletVector.push(t)},this),this.schedule(function(){this.enemyLock&&(this.timeLabel.string-=1,this.timeLabel.string<0&&(this.timeStep+=10,this.timeLabel.string=this.timeStep,this.enemySpeed+=.5,this.levelLabel.string+=1))},1)},update:function(t){this.bulletLabel.string=parseInt(this.powerBar.progress*this.bulletNum),this.backgroundLayer.x<300&&(this.noticeLabel.node.removeFromParent(!1),this.enemyLock=!0),this.enemyLock&&S.createAmaryInVectorAuto(M.enemyVector,this.backgroundLayer,T.getRandPos(cc.p(600,316.8),cc.p(-300,-158.4))),b.updateCamera(this.backgroundLayer),v.faceTargetByAngle(this.weapon.rotation,this.hero.getChildByName("spr")),!0===b.getStatus()?this.weapon.rotation=-T.transformAngle(b.getMoveAngle()):this.weapon.rotation=-T.transformAngle(b.getLastAngle()),(this.heroBlood.progress<.01||this.bulletLabel.string<0)&&(M.score=this.scoreLabel.string,cc.director.loadScene("OverScene"));var e=!0,o=!1,r=void 0;try{for(var n,c=M.enemyVector[Symbol.iterator]();!(e=(n=c.next()).done);e=!0){var i=n.value;v.moveFollowTarget(i,T.getPosNegative(this.backgroundLayer.position),this.enemySpeed),v.faceToTarget(this.weapon,T.addTwoPos(this.backgroundLayer.position,i)),v.faceTargetToX(T.getPosNegative(this.backgroundLayer.position),this.hero.getChildByName("spr"),i),L.testPos(T.getPosNegative(this.backgroundLayer.position),i.position,10)&&(this.heroBlood.progress-=.005,this.heroBloodLabel.string=parseInt(100*this.heroBlood.progress))}}catch(t){o=!0,r=t}finally{try{!e&&c.return&&c.return()}finally{if(o)throw r}}var a=!0,s=!1,l=void 0;try{for(var u,h=M.bulletVector[Symbol.iterator]();!(a=(u=h.next()).done);a=!0){var p=u.value,d=!0,g=!1,f=void 0;try{for(var y,m=M.enemyVector[Symbol.iterator]();!(d=(y=m.next()).done);d=!0){i=y.value;L.testPos(p.position,i.position,30)&&(i.getChildByName("blood").getComponent(cc.ProgressBar).progress-=.2,this.current=cc.audioEngine.play(this.audio,!1,1),i.getChildByName("blood").getComponent(cc.ProgressBar).progress<.05&&(i.destroy(),M.enemyVector.pop(),this.scoreLabel.string+=1,this.powerBar.progress+=.14,1<this.powerBar.progress&&(this.powerBar.progress=1)))}}catch(t){g=!0,f=t}finally{try{!d&&m.return&&m.return()}finally{if(g)throw f}}}}catch(t){s=!0,l=t}finally{try{!a&&h.return&&h.return()}finally{if(s)throw l}}}}),cc._RF.pop()},{AnimationMediator:"AnimationMediator",BarManager:"BarManager",CollisionManager:"CollisionManager",EnemyFactory:"EnemyFactory",GlobalData:"GlobalData",MathVec:"MathVec",MoveCtrllor:"MoveCtrllor",SceneMediator:"SceneMediator"}],SceneMediator:[function(t,e,o){"use strict";cc._RF.push(e,"9d400G8LvpDOp0GSqvk5SMw","SceneMediator");var r={activeScene:null,initActiveScene:function(t){cc.director.loadScene(t),cc.director.getScene()},backtoStartScene:function(){PlayScene.active=!1,cc.director.loadScene("StartScene")},gotoPlayScene:function(){PlayScene.active=!0,cc.director.loadScene("PlayScene")},backtoPlayScene:function(){cc.director.loadScene("PlayScene")},gotoOverScene:function(){cc.director.loadScene("OverScene")}};e.exports=r,cc._RF.pop()},{}],StartScene:[function(t,e,o){"use strict";cc._RF.push(e,"9b537sOdDNLG7PQaEAbuNHH","StartScene");var r=t("AnimationMediator");cc.Class({extends:cc.Component,properties:{startBtn:cc.Button,backgroundSpr:cc.Sprite,audio:cc.AudioClip},start:function(){this.startBtn.node.on("click",this.gotoPlayScene,this)},gotoPlayScene:function(){this.current=cc.audioEngine.play(this.audio,!1,1),cc.director.loadScene("PlayScene")},update:function(t){r.backgroundLoop(this.backgroundSpr.node,64)}}),cc._RF.pop()},{AnimationMediator:"AnimationMediator"}]},{},["AnimationMediator","BarManager","CollisionManager","EnemyFactory","GlobalData","JsTool","MathVec","MoveCtrllor","OverScene","PlayScene","SceneMediator","StartScene"]);