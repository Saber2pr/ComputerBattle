require=function c(i,a,s){function l(t,e){if(!a[t]){if(!i[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(u)return u(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var n=a[t]={exports:{}};i[t][0].call(n.exports,function(e){return l(i[t][1][e]||e)},n,n.exports,c,i,a,s)}return a[t].exports}for(var u="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({AnimationMediator:[function(e,t,o){"use strict";cc._RF.push(t,"5faecb4HlZD251MisyYcR0X","AnimationMediator");var u=e("MathVec"),r={backgroundLoop:function(e,t,o,r){var n=void 0===r?1:r;e.x>-t?(e.x-=n,e.y-="toLeft"===o?0:n):e.setPosition(0,0)},moveFollowTarget:function(e,t,o){var r=void 0===o?1:o,n=u.getFront(e,t);e.setPosition(e.x+n.x*r,e.y+n.y*r)},fireOnce:function(e,t,o,r,n){e.runAction(cc.moveTo(2*r,u.getPos(o,t))),n.scheduleOnce(function(){e.destroy()},2*r)},fireToTargetOnce:function(e,t,o,r){o.parent.convertToWorldSpace(o.position);e.runAction(cc.moveTo(2*t,cc.v2(o.x,o.y))),r.scheduleOnce(function(){e.destroy()},2*t)},randColor:function(){var e=200*cc.random0To1(),t=200*cc.random0To1(),o=200*cc.random0To1();return cc.color(e,t,o)},faceToTarget:function(e,t,o){r.rotateToTarget(e,t,o)},faceToNearestTarget:function(e,t,o){this.faceToTarget(e,t,this.getNearestTarget(t,o))},getNearestTarget:function(e,t){var o=[],r=!0,n=!1,c=void 0;try{for(var i,a=t[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var s=i.value;o.push(parseInt(u.getDistance(e,s)))}}catch(e){n=!0,c=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw c}}var l=u.getMinFromVector(o);if(0<t.length)return t[u.getOrderFromVector(l,o)]},rotateToTarget:function(e,t,o){e.rotation=-u.transformAngle(u.getAngle(u.getFront(t,o)))},followRotate:function(e,t){e.rotation=t.rotation},faceTargetToX:function(e,t,o){0<e.x-o.x?t.runAction(cc.flipX(!0)):t.runAction(cc.flipX(!1))},faceTargetByAngle:function(e,t){90<Math.abs(e)?t.runAction(cc.flipX(!0)):t.runAction(cc.flipX(!1))}};t.exports=r,cc._RF.pop()},{MathVec:"MathVec"}],BarManager:[function(e,t,o){"use strict";cc._RF.push(t,"58f7au2jaxKyoSnWV+IEHb1","BarManager");var r={add:null,reduce:null,reduceSpeed:.03,bar:null,that:null,initBar:function(e,t){this.bar=e,this.bar.progress=0,this.that=t},initPowerBtn:function(e){e.node.on("touchstart",this.addBarSch,this.that),e.node.on("touchend",this.reduceBarSch,this.that),e.node.on("touchcancel",this.reduceBarSch,this.that)},pro1:{value:.3,color:cc.Color.GREEN,speed:.01},pro2:{value:.7,color:cc.Color.YELLOW,speed:.003},pro3:{value:.99,color:cc.Color.BLUE,speed:.001},pro4:{color:cc.Color.BLACK},testPro:function(e,t){return e.progress<t.value},colorBar:function(){var e=this.bar;this.testPro(e,this.pro1)?e.barSprite.node.color=this.pro1.color:this.testPro(e,this.pro2)?e.barSprite.node.color=this.pro2.color:this.testPro(e,this.pro3)?e.barSprite.node.color=this.pro3.color:e.barSprite.node.color=this.pro4.color},addPower:function(){var e=this.bar;this.testPro(e,this.pro1)?e.progress+=this.pro1.speed:this.testPro(e,this.pro2)?e.progress+=this.pro2.speed:this.testPro(e,this.pro3)?e.progress+=this.pro3.speed:e.progress=1,this.colorBar(e)},reducePower:function(){var e=this.bar;.1<e.progress?e.progress-=this.reduceSpeed:e.progress=0,this.colorBar(e)},addBarSch:function(){var e=this.bar;r.that.unschedule(this.reduce),r.that.schedule(this.add=function(){r.addPower(e)},.01)},reduceBarSch:function(){var e=this.bar;r.that.unschedule(this.add),r.that.schedule(this.reduce=function(){r.reducePower(e)},.01)},getColorFromBar:function(e){return e.barSprite.node.color}};t.exports=r,cc._RF.pop()},{}],CollisionManager:[function(e,t,o){"use strict";cc._RF.push(t,"ea04c87alxNy6a77fpFvYny","CollisionManager");var r=e("MathVec"),n={testPos:function(e,t,o){return r.getDistance(e,t)<o}};t.exports=n,cc._RF.pop()},{MathVec:"MathVec"}],EnemyFactory:[function(e,t,o){"use strict";cc._RF.push(t,"0fb64MfKrFPBa4mdJmb5Mv/","EnemyFactory");var n=e("AnimationMediator"),r=(e("GlobalData"),e("MathVec")),c={enemySpriteList:null,enemyType:null,enemyPool:null,bulletType:null,bulletPool:null,that:null,initSource:function(e,t,o,r){this.that=o,this.enemySpriteList=r,this.enemyType=e,this.bulletType=t,this.enemyPool=new cc.NodePool,this.bulletPool=new cc.NodePool,c.fillPool()},fillPool:function(){for(var e=0;e<5;++e){var t=cc.instantiate(c.enemyType);t.getChildByName("spr").getComponent(cc.Sprite).spriteFrame=c.getRandSpriteFrame(),this.enemyPool.put(t);var o=cc.instantiate(c.bulletType);o.color=n.randColor(),this.bulletPool.put(o)}},createAmary:function(e,t){var o="undefined"===t?cc.p(100,100):t,r=this.getTypeNodeFromPool(this.enemyPool);return r.parent=e,r.position=o,r},createBullet:function(e,t){var o=c.getTypeNodeFromPool(this.bulletPool);return o.active=!1,o.parent=e.parent,o.scaleX=1,o.scaleY=1,o.setPosition(0,0),n.fireOnce(o,500,r.transformAngleToRad(-e.rotation),.2,this.that),cc.log(e.rotation),o},createBulletToEnemy:function(e,t,o){var r=this.getTypeNodeFromPool(this.bulletPool);return r.parent=t,r.setPosition(e),n.fireToTargetOnce(r,.1,n.getNearestTarget(e,o),this.that),r},getTypeNodeFromPool:function(e){return 0<e.size()||c.fillPool(),e.get()},getRandSpriteFrame:function(){return r.getRandElem(c.enemySpriteList)},createAmaryInVectorAuto:function(e,t,o,r){e.length<o&&e.push(c.createAmary(t,r))}};t.exports=c,cc._RF.pop()},{AnimationMediator:"AnimationMediator",GlobalData:"GlobalData",MathVec:"MathVec"}],GlobalData:[function(e,t,o){"use strict";cc._RF.push(t,"81343kHnX9MZbUxuYQQw7mL","GlobalData");t.exports={enemyVector:null,enemySprite:[],bulletVector:null,score:null,scoreVector:[],level:null,levelVector:[]},cc._RF.pop()},{}],Hero:[function(e,t,o){"use strict";cc._RF.push(t,"43a2bboqGROurz5VasLC0qM","Hero"),cc.Class({extends:cc.Component,properties:{},onBeginContact:function(e,t,o){var r=e.getWorldManifold().points;cc.log(r)},start:function(){}}),cc._RF.pop()},{}],JsTool:[function(e,t,o){"use strict";cc._RF.push(t,"c37a4VnHgRDF4fVamaoqiep","JsTool");var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window.JsTool={obj2string:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var t=[];if("string"==typeof e)return'"'+e.replace(/([\'\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+'"';if("object"===(void 0===e?"undefined":r(e))){if(e.sort){for(o=0;o<e.length;o++)t.push(obj2string(e[o]));t="["+t.join()+"]"}else{for(var o in e)t.push(o+":"+this.obj2string(e[o]));document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(e.toString)&&t.push("toString:"+e.toString.toString()),t="{"+t.join()+"}"}return t}return e.toString()}),writeObj:function(e){var t="";for(var o in e){t+=o+" = "+e[o]+"\n"}console.log(t)}},cc._RF.pop()},{}],MathVec:[function(e,t,o){"use strict";cc._RF.push(t,"d2c3ak2T4JMyqLgjCrvpsNy","MathVec");var r={limitToCircle:function(e,t){return this.getLength(e)<t?e:this.getPos(this.getAngle(e),t)},limitToRect:function(e,t,o){return cc.v2(this.limitToWall(e.x,t),this.limitToWall(e.y,o))},limitToWall:function(e,t){return Math.abs(e)<t?e:0<e?t:-t},getAngle:function(e){return 0<e.y?Math.acos(e.x/e.mag()):-Math.acos(e.x/e.mag())},transformAngle:function(e){return 180*e/Math.PI},transformAngleToRad:function(e){return e/(180*Math.PI)},getPos:function(e,t){return cc.v2(t*Math.cos(e),t*Math.sin(e))},getLength:function(e){return e.mag()},getRandNum:function(e,t){return"x"===t?cc.v2(e.x*cc.random0To1(),e.y):cc.v2(e.x,e.y*cc.random0To1())},getRandPos:function(e,t){return cc.v2(e.x*cc.random0To1()+t.x,e.y*cc.random0To1()+t.y)},getFront:function(e,t){var o=cc.v2(t.x-e.x,t.y-e.y);return cc.v2(o.x/o.mag(),o.y/o.mag())},getDistance:function(e,t){return cc.v2(t.x-e.x,t.y-e.y).mag()},transformToParentWorld:function(e){return cc.v2(e.parent.x+e.x,e.parent.y+e.y)},getMaxFromVector:function(e){return Math.max.apply(null,e)},getMinFromVector:function(e){return Math.min.apply(null,e)},getOrderFromVector:function(e,t){for(var o=0;o<t.length;o++)if(e===t[o])return o},getPosNegative:function(e){return cc.v2(-e.x,-e.y)},addTwoPos:function(e,t,o){return cc.p(e.x+t.x,e.y+t.y)},getRandElem:function(e){return e[parseInt(e.length*cc.random0To1())]}};t.exports=r,cc._RF.pop()},{}],MoveCtrllor:[function(e,t,o){"use strict";cc._RF.push(t,"763dc39VJZILq/I9U0Mwt1s","MoveCtrllor");var c=e("MathVec"),i={angle:null,force:null,status:null,heroSpeed:null,radius:null,lastAngle:null,onload:function(e){this.lastAngle=this.angle,this.angle=0,this.force=0,this.status=!1,e.node.setPosition(0,0)},init:function(r,n,e,t){i.onload(n),this.radius=void 0===e?25:e,this.heroSpeed=void 0===t?5:t,r.node.on("touchstart",function(e){this.status=!0},this),r.node.on("touchmove",function(e){var t=r.node.convertToNodeSpaceAR(e.getLocation()),o=c.limitToCircle(t,this.radius);n.node.setPosition(o),this.angle=c.getAngle(o),this.force=c.getLength(o)/this.radius},this),r.node.on("touchend",function(e){this.onload(n)},this),r.node.on("touchcancel",function(e){this.onload(n)},this)},getMoveAngle:function(){return this.angle},getLastAngle:function(){return this.lastAngle},getForce:function(){return this.force},getStatus:function(){return this.status},updateCharacter:function(e){this.directToDes(e,"character")},updateCamera:function(e){this.directToDes(e,"camera")},directToDes:function(e,t){if(!0===this.getStatus()){var o=this.getMoveAngle(),r=this.getForce(),n="character"===t?cc.p(e.x+this.heroSpeed*Math.cos(o)*r,e.y+this.heroSpeed*Math.sin(o)*r):"camera"===t?cc.p(e.x-this.heroSpeed*Math.cos(o)*r,e.y-this.heroSpeed*Math.sin(o)*r):console.log("methodError");e.position=cc.v2(c.limitToRect(n,495,158.4))}}};t.exports=i,cc._RF.pop()},{MathVec:"MathVec"}],OverScene:[function(e,t,o){"use strict";cc._RF.push(t,"29194r7yDVFR7LWiLOoJhxo","OverScene");var r=e("GlobalData"),n=e("AnimationMediator");cc.Class({extends:cc.Component,properties:{restartBtn:cc.Button,newScore:cc.Label,newLevel:cc.Label,hScore:cc.Label,hLevel:cc.Label,backgroundSpr:cc.Sprite,audio:cc.AudioClip},onLoad:function(){this.updateLabel(this.newScore,this.hScore,r.score,r.scoreVector),this.updateLabel(this.newLevel,this.hLevel,r.level,r.levelVector)},updateLabel:function(e,t,o,r){e.string=o,r.push(e.string),t.string=Math.max.apply(null,r)},start:function(){this.restartBtn.node.on("click",function(){this.current=cc.audioEngine.play(this.audio,!1,1),cc.director.loadScene("PlayScene")},this)},update:function(e){n.backgroundLoop(this.backgroundSpr.node,64)}}),cc._RF.pop()},{AnimationMediator:"AnimationMediator",GlobalData:"GlobalData"}],PlayScene:[function(e,t,o){"use strict";cc._RF.push(t,"4fe5ezPc4ZICqjhyupIpGWo","PlayScene");e("SceneMediator");var g=e("MoveCtrllor"),f=(e("BarManager"),e("EnemyFactory")),y=e("AnimationMediator"),m=e("GlobalData"),b=e("MathVec"),v=e("CollisionManager");cc.Class({extends:cc.Component,properties:{PlayScene:cc.Node,audio:cc.AudioClip,backgroundLayer:cc.Node,wall:cc.Node,noticeLabel:cc.Label,scoreLabel:cc.Label,timeLabel:cc.Label,heroBloodLabel:cc.Label,bulletLabel:cc.Label,ideaLabel:cc.Label,levelLabel:cc.Label,pauseLayout:cc.Layout,pauseBtn:cc.Button,backBtn:cc.Button,basic:cc.Sprite,touch:cc.Sprite,powerBtn:cc.Button,hero:cc.Node,heroBlood:cc.ProgressBar,powerBar:cc.ProgressBar,ideaBar:cc.ProgressBar,weapon:cc.Node,enemyBar:cc.ProgressBar,enemySpriteList:{default:[],type:[cc.SpriteFrame]},enemyType:cc.Node,bulletType:cc.Node},enemyLock:null,enemyNum:null,enemySpeed:null,timeStep:null,bulletNum:null,count:null,nextCount:null,onLoad:function(){this.bulletNum=20,this.timeLabel.string=0,this.timeStep=10,this.timeLabel.string+=this.timeStep,this.bulletLabel.string=this.bulletNum,this.levelLabel.string=1,this.scoreLabel.string=0,this.heroBlood.progress=1,this.powerBar.progress=1,this.enemySpeed=.5,this.enemyLock=!1,this.enemyNum=1,this.count=0,m.enemyVector=[],m.bulletVector=[],g.init(this.basic,this.touch),f.initSource(this.enemyType,this.bulletType,this,this.enemySpriteList)},start:function(){this.pauseBtn.node.on("click",function(){this.current=cc.audioEngine.play(this.audio,!1,1),this.pauseIn()},this),this.backBtn.node.on("click",function(){this.current=cc.audioEngine.play(this.audio,!1,1),this.pauseOut(),cc.director.loadScene("StartScene")},this),this.powerBtn.node.on("click",function(){if(0<m.enemyVector.length)var e=f.createBulletToEnemy(this.backgroundLayer.convertToNodeSpace(this.weapon),this.backgroundLayer,m.enemyVector);else e=f.createBullet(this.weapon,this.backgroundLayer);this.powerBar.progress-=1/this.bulletNum,m.bulletVector.push(e)},this),this.schedule(function(){this.enemyLock&&(this.timeLabel.string-=1,this.timeLabel.string<0&&(this.timeStep+=10,this.timeLabel.string=this.timeStep,this.enemySpeed+=.5,this.levelLabel.string+=1,this.enemyNum+=2))},1)},update:function(e){this.bulletLabel.string=parseInt(this.powerBar.progress*this.bulletNum),this.ideaLabel.string=parseInt(100*this.ideaBar.progress);var t=!0,o=!1,r=void 0;try{for(var n,c=m.bulletVector[Symbol.iterator]();!(t=(n=c.next()).done);t=!0)for(var i=n.value,a=0;a<m.enemyVector.length;a++){var s=m.enemyVector[a];v.testPos(i.position,s.position,30)&&(s.getChildByName("blood").getComponent(cc.ProgressBar).progress-=.2,this.current=cc.audioEngine.play(this.audio,!1,1),s.getChildByName("blood").getComponent(cc.ProgressBar).progress<.05&&(s.destroy(),m.enemyVector.splice(a,1),a-=1,this.scoreLabel.string+=1))}}catch(e){o=!0,r=e}finally{try{!t&&c.return&&c.return()}finally{if(o)throw r}}!0===g.getStatus()?this.weapon.rotation=-b.transformAngle(g.getMoveAngle()):this.weapon.rotation=-b.transformAngle(g.getLastAngle()),this.backgroundLayer.x<300&&(this.noticeLabel.node.removeFromParent(!1),this.enemyLock=!0),60<this.count&&(this.ideaBar.progress-=.005,this.powerBar.progress+=.005,1<this.powerBar.progress&&(this.powerBar.progress=1)),this.enemyLock&&(this.count+=1,!0===g.getStatus()&&(this.count=0,this.ideaBar.progress<=1&&(this.ideaBar.progress+=.005)),f.createAmaryInVectorAuto(m.enemyVector,this.backgroundLayer,this.enemyNum,b.getRandPos(cc.p(600,316.8),cc.p(-300,-158.4))),y.faceToNearestTarget(this.weapon,b.getPosNegative(this.backgroundLayer.position),m.enemyVector)),y.faceTargetByAngle(this.weapon.rotation,this.hero.getChildByName("spr")),g.updateCamera(this.backgroundLayer),(this.heroBlood.progress<.01||this.bulletLabel.string<0||this.ideaBar.progress<.01)&&(m.score=this.scoreLabel.string,m.level=this.levelLabel.string,cc.director.loadScene("OverScene"));var l=!0,u=!1,h=void 0;try{for(var p,d=m.enemyVector[Symbol.iterator]();!(l=(p=d.next()).done);l=!0){s=p.value;y.moveFollowTarget(s,b.getPosNegative(this.backgroundLayer.position),this.enemySpeed),y.faceTargetToX(b.getPosNegative(this.backgroundLayer.position),this.hero.getChildByName("spr"),s),v.testPos(b.getPosNegative(this.backgroundLayer.position),s.position,10)&&(this.heroBlood.progress-=.005,this.heroBloodLabel.string=parseInt(100*this.heroBlood.progress))}}catch(e){u=!0,h=e}finally{try{!l&&d.return&&d.return()}finally{if(u)throw h}}},pauseIn:function(){if(-300<this.pauseLayout.node.y&&!cc.director.isPaused()){var e=this.pauseLayout.node.getComponent(cc.Animation).play();this.scheduleOnce(function(){cc.director.pause()},e.duration)}else cc.director.resume(),this.pauseLayout.node.y+=694},pauseOut:function(){cc.director.resume(),this.pauseLayout.node.y+=694}}),cc._RF.pop()},{AnimationMediator:"AnimationMediator",BarManager:"BarManager",CollisionManager:"CollisionManager",EnemyFactory:"EnemyFactory",GlobalData:"GlobalData",MathVec:"MathVec",MoveCtrllor:"MoveCtrllor",SceneMediator:"SceneMediator"}],SceneMediator:[function(e,t,o){"use strict";cc._RF.push(t,"9d400G8LvpDOp0GSqvk5SMw","SceneMediator");var r={activeScene:null,initActiveScene:function(e){cc.director.loadScene(e),cc.director.getScene()},backtoStartScene:function(){PlayScene.active=!1,cc.director.loadScene("StartScene")},gotoPlayScene:function(){PlayScene.active=!0,cc.director.loadScene("PlayScene")},backtoPlayScene:function(){cc.director.loadScene("PlayScene")},gotoOverScene:function(){cc.director.loadScene("OverScene")}};t.exports=r,cc._RF.pop()},{}],StartScene:[function(e,t,o){"use strict";cc._RF.push(t,"9b537sOdDNLG7PQaEAbuNHH","StartScene");var r=e("AnimationMediator");cc.Class({extends:cc.Component,properties:{startBtn:cc.Button,backgroundSpr:cc.Sprite,audio:cc.AudioClip},bool:null,start:function(){this.bool=!0,this.startBtn.node.on("click",this.gotoPlayScene,this),this.schedule(function(){this.bool=!this.bool},1)},gotoPlayScene:function(){this.current=cc.audioEngine.play(this.audio,!1,1),cc.director.loadScene("PlayScene")},update:function(e){this.startBtn.node.active=this.bool,r.backgroundLoop(this.backgroundSpr.node,64)}}),cc._RF.pop()},{AnimationMediator:"AnimationMediator"}]},{},["AnimationMediator","BarManager","CollisionManager","EnemyFactory","GlobalData","Hero","JsTool","MathVec","MoveCtrllor","OverScene","PlayScene","SceneMediator","StartScene"]);