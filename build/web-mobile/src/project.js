require=function i(c,a,s){function l(e,t){if(!a[e]){if(!c[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(u)return u(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var n=a[e]={exports:{}};c[e][0].call(n.exports,function(t){return l(c[e][1][t]||t)},n,n.exports,i,c,a,s)}return a[e].exports}for(var u="function"==typeof require&&require,t=0;t<s.length;t++)l(s[t]);return l}({AnimationMediator:[function(t,e,o){"use strict";cc._RF.push(e,"5faecb4HlZD251MisyYcR0X","AnimationMediator");var u=t("MathVec"),r={backgroundLoop:function(t,e,o,r){var n=void 0===r?1:r;t.x>-e?(t.x-=n,t.y-="toLeft"===o?0:n):t.setPosition(0,0)},moveFollowTarget:function(t,e,o){var r=void 0===o?1:o,n=u.getFront(t,e);t.setPosition(t.x+n.x*r,t.y+n.y*r)},fireOnce:function(t,e,o,r,n){t.runAction(cc.moveTo(2*r,u.getPos(o,e))),n.scheduleOnce(function(){t.destroy()},2*r)},fireToTargetOnce:function(t,e,o,r){o.parent.convertToWorldSpace(o.position);t.runAction(cc.moveTo(2*e,cc.v2(o.x,o.y))),r.scheduleOnce(function(){t.destroy()},2*e)},randColor:function(){var t=200*cc.random0To1(),e=200*cc.random0To1(),o=200*cc.random0To1();return cc.color(t,e,o)},faceToTarget:function(t,e,o){r.rotateToTarget(t,e,o)},faceToNearestTarget:function(t,e,o){this.faceToTarget(t,e,this.getNearestTarget(e,o))},getNearestTarget:function(t,e){var o=[],r=!0,n=!1,i=void 0;try{for(var c,a=e[Symbol.iterator]();!(r=(c=a.next()).done);r=!0){var s=c.value;o.push(parseInt(u.getDistance(t,s)))}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}var l=u.getMinFromVector(o);if(0<e.length)return e[u.getOrderFromVector(l,o)]},rotateToTarget:function(t,e,o){t.rotation=-u.transformAngle(u.getAngle(u.getFront(e,o)))},followRotate:function(t,e){t.rotation=e.rotation},faceTargetToX:function(t,e,o){0<t.x-o.x?e.runAction(cc.flipX(!0)):e.runAction(cc.flipX(!1))},faceTargetByAngle:function(t,e){90<Math.abs(t)?e.runAction(cc.flipX(!0)):e.runAction(cc.flipX(!1))}};e.exports=r,cc._RF.pop()},{MathVec:"MathVec"}],BarManager:[function(t,e,o){"use strict";cc._RF.push(e,"58f7au2jaxKyoSnWV+IEHb1","BarManager");var r={add:null,reduce:null,reduceSpeed:.03,bar:null,that:null,initBar:function(t,e){this.bar=t,this.bar.progress=0,this.that=e},initPowerBtn:function(t){t.node.on("touchstart",this.addBarSch,this.that),t.node.on("touchend",this.reduceBarSch,this.that),t.node.on("touchcancel",this.reduceBarSch,this.that)},pro1:{value:.3,color:cc.Color.GREEN,speed:.01},pro2:{value:.7,color:cc.Color.YELLOW,speed:.003},pro3:{value:.99,color:cc.Color.BLUE,speed:.001},pro4:{color:cc.Color.BLACK},testPro:function(t,e){return t.progress<e.value},colorBar:function(){var t=this.bar;this.testPro(t,this.pro1)?t.barSprite.node.color=this.pro1.color:this.testPro(t,this.pro2)?t.barSprite.node.color=this.pro2.color:this.testPro(t,this.pro3)?t.barSprite.node.color=this.pro3.color:t.barSprite.node.color=this.pro4.color},addPower:function(){var t=this.bar;this.testPro(t,this.pro1)?t.progress+=this.pro1.speed:this.testPro(t,this.pro2)?t.progress+=this.pro2.speed:this.testPro(t,this.pro3)?t.progress+=this.pro3.speed:t.progress=1,this.colorBar(t)},reducePower:function(){var t=this.bar;.1<t.progress?t.progress-=this.reduceSpeed:t.progress=0,this.colorBar(t)},addBarSch:function(){var t=this.bar;r.that.unschedule(this.reduce),r.that.schedule(this.add=function(){r.addPower(t)},.01)},reduceBarSch:function(){var t=this.bar;r.that.unschedule(this.add),r.that.schedule(this.reduce=function(){r.reducePower(t)},.01)},getColorFromBar:function(t){return t.barSprite.node.color}};e.exports=r,cc._RF.pop()},{}],CollisionManager:[function(t,e,o){"use strict";cc._RF.push(e,"ea04c87alxNy6a77fpFvYny","CollisionManager");var r=t("MathVec"),n={testPos:function(t,e,o){return r.getDistance(t,e)<o}};e.exports=n,cc._RF.pop()},{MathVec:"MathVec"}],EnemyFactory:[function(t,e,o){"use strict";cc._RF.push(e,"0fb64MfKrFPBa4mdJmb5Mv/","EnemyFactory");var n=t("AnimationMediator"),r=(t("GlobalData"),t("MathVec")),i={enemySpriteList:null,enemyType:null,enemyPool:null,bulletType:null,bulletPool:null,that:null,initSource:function(t,e,o,r){this.that=o,this.enemySpriteList=r,this.enemyType=t,this.bulletType=e,this.enemyPool=new cc.NodePool,this.bulletPool=new cc.NodePool,i.fillPool()},fillPool:function(){for(var t=0;t<5;++t){var e=cc.instantiate(i.enemyType);e.getChildByName("spr").getComponent(cc.Sprite).spriteFrame=i.getRandSpriteFrame(),this.enemyPool.put(e);var o=cc.instantiate(i.bulletType);o.color=n.randColor(),this.bulletPool.put(o)}},createAmary:function(t,e){var o="undefined"===e?cc.p(100,100):e,r=this.getTypeNodeFromPool(this.enemyPool);return r.parent=t,r.position=o,r},createBullet:function(t,e){var o=i.getTypeNodeFromPool(this.bulletPool);return o.active=!1,o.parent=t.parent,o.scaleX=1,o.scaleY=1,o.setPosition(0,0),n.fireOnce(o,500,r.transformAngleToRad(-t.rotation),.2,this.that),cc.log(t.rotation),o},createBulletToEnemy:function(t,e,o){var r=this.getTypeNodeFromPool(this.bulletPool);return r.parent=e,r.setPosition(t),n.fireToTargetOnce(r,.1,n.getNearestTarget(t,o),this.that),r},getTypeNodeFromPool:function(t){return 0<t.size()||i.fillPool(),t.get()},getRandSpriteFrame:function(){return r.getRandElem(i.enemySpriteList)},createAmaryInVectorAuto:function(t,e,o,r){t.length<o&&t.push(i.createAmary(e,r))}};e.exports=i,cc._RF.pop()},{AnimationMediator:"AnimationMediator",GlobalData:"GlobalData",MathVec:"MathVec"}],GlobalData:[function(t,e,o){"use strict";cc._RF.push(e,"81343kHnX9MZbUxuYQQw7mL","GlobalData");e.exports={enemyVector:null,enemySprite:[],bulletVector:null,score:null,scoreVector:[],level:null,levelVector:[]},cc._RF.pop()},{}],JsTool:[function(t,e,o){"use strict";cc._RF.push(e,"c37a4VnHgRDF4fVamaoqiep","JsTool");var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};window.JsTool={obj2string:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(t){var e=[];if("string"==typeof t)return'"'+t.replace(/([\'\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+'"';if("object"===(void 0===t?"undefined":r(t))){if(t.sort){for(o=0;o<t.length;o++)e.push(obj2string(t[o]));e="["+e.join()+"]"}else{for(var o in t)e.push(o+":"+this.obj2string(t[o]));document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(t.toString)&&e.push("toString:"+t.toString.toString()),e="{"+e.join()+"}"}return e}return t.toString()}),writeObj:function(t){var e="";for(var o in t){e+=o+" = "+t[o]+"\n"}console.log(e)}},cc._RF.pop()},{}],MathVec:[function(t,e,o){"use strict";cc._RF.push(e,"d2c3ak2T4JMyqLgjCrvpsNy","MathVec");var r={limitToCircle:function(t,e){return this.getLength(t)<e?t:this.getPos(this.getAngle(t),e)},limitToRect:function(t,e,o){return cc.v2(this.limitToWall(t.x,e),this.limitToWall(t.y,o))},limitToWall:function(t,e){return Math.abs(t)<e?t:0<t?e:-e},getAngle:function(t){return 0<t.y?Math.acos(t.x/t.mag()):-Math.acos(t.x/t.mag())},transformAngle:function(t){return 180*t/Math.PI},transformAngleToRad:function(t){return t/(180*Math.PI)},getPos:function(t,e){return cc.v2(e*Math.cos(t),e*Math.sin(t))},getLength:function(t){return t.mag()},getRandNum:function(t,e){return"x"===e?cc.v2(t.x*cc.random0To1(),t.y):cc.v2(t.x,t.y*cc.random0To1())},getRandPos:function(t,e){return cc.v2(t.x*cc.random0To1()+e.x,t.y*cc.random0To1()+e.y)},getFront:function(t,e){var o=cc.v2(e.x-t.x,e.y-t.y);return cc.v2(o.x/o.mag(),o.y/o.mag())},getDistance:function(t,e){return cc.v2(e.x-t.x,e.y-t.y).mag()},transformToParentWorld:function(t){return cc.v2(t.parent.x+t.x,t.parent.y+t.y)},getMaxFromVector:function(t){return Math.max.apply(null,t)},getMinFromVector:function(t){return Math.min.apply(null,t)},getOrderFromVector:function(t,e){for(var o=0;o<e.length;o++)if(t===e[o])return o},getPosNegative:function(t){return cc.v2(-t.x,-t.y)},addTwoPos:function(t,e,o){return cc.p(t.x+e.x,t.y+e.y)},getRandElem:function(t){return t[parseInt(t.length*cc.random0To1())]}};e.exports=r,cc._RF.pop()},{}],MoveCtrllor:[function(t,e,o){"use strict";cc._RF.push(e,"763dc39VJZILq/I9U0Mwt1s","MoveCtrllor");var i=t("MathVec"),c={angle:null,force:null,status:null,heroSpeed:null,radius:null,lastAngle:null,onload:function(t){this.lastAngle=this.angle,this.angle=0,this.force=0,this.status=!1,t.node.setPosition(0,0)},init:function(r,n,t,e){c.onload(n),this.radius=void 0===t?25:t,this.heroSpeed=void 0===e?5:e,r.node.on("touchstart",function(t){this.status=!0},this),r.node.on("touchmove",function(t){var e=r.node.convertToNodeSpaceAR(t.getLocation()),o=i.limitToCircle(e,this.radius);n.node.setPosition(o),this.angle=i.getAngle(o),this.force=i.getLength(o)/this.radius},this),r.node.on("touchend",function(t){this.onload(n)},this),r.node.on("touchcancel",function(t){this.onload(n)},this)},getMoveAngle:function(){return this.angle},getLastAngle:function(){return this.lastAngle},getForce:function(){return this.force},getStatus:function(){return this.status},updateCharacter:function(t){this.directToDes(t,"character")},updateCamera:function(t){this.directToDes(t,"camera")},directToDes:function(t,e){if(!0===this.getStatus()){var o=this.getMoveAngle(),r=this.getForce(),n="character"===e?cc.p(t.x+this.heroSpeed*Math.cos(o)*r,t.y+this.heroSpeed*Math.sin(o)*r):"camera"===e?cc.p(t.x-this.heroSpeed*Math.cos(o)*r,t.y-this.heroSpeed*Math.sin(o)*r):console.log("methodError");t.position=cc.v2(i.limitToRect(n,495,158.4))}}};e.exports=c,cc._RF.pop()},{MathVec:"MathVec"}],OverScene:[function(t,e,o){"use strict";cc._RF.push(e,"29194r7yDVFR7LWiLOoJhxo","OverScene");var r=t("GlobalData"),n=t("AnimationMediator");cc.Class({extends:cc.Component,properties:{restartBtn:cc.Button,newScore:cc.Label,newLevel:cc.Label,hScore:cc.Label,hLevel:cc.Label,backgroundSpr:cc.Sprite,audio:cc.AudioClip},onLoad:function(){this.updateLabel(this.newScore,this.hScore,r.score,r.scoreVector),this.updateLabel(this.newLevel,this.hLevel,r.level,r.levelVector)},updateLabel:function(t,e,o,r){t.string=o,r.push(t.string),e.string=Math.max.apply(null,r)},start:function(){this.restartBtn.node.on("click",function(){this.current=cc.audioEngine.play(this.audio,!1,1),cc.director.loadScene("PlayScene")},this)},update:function(t){n.backgroundLoop(this.backgroundSpr.node,64)}}),cc._RF.pop()},{AnimationMediator:"AnimationMediator",GlobalData:"GlobalData"}],PlayScene:[function(t,e,o){"use strict";cc._RF.push(e,"4fe5ezPc4ZICqjhyupIpGWo","PlayScene");t("SceneMediator");var g=t("MoveCtrllor"),f=(t("BarManager"),t("EnemyFactory")),y=t("AnimationMediator"),m=t("GlobalData"),b=t("MathVec"),v=t("CollisionManager");cc.Class({extends:cc.Component,properties:{PlayScene:cc.Node,audio:cc.AudioClip,backgroundLayer:cc.Node,noticeLabel:cc.Label,scoreLabel:cc.Label,timeLabel:cc.Label,heroBloodLabel:cc.Label,bulletLabel:cc.Label,ideaLabel:cc.Label,levelLabel:cc.Label,pauseLayout:cc.Layout,pauseBtn:cc.Button,backBtn:cc.Button,basic:cc.Sprite,touch:cc.Sprite,powerBtn:cc.Button,hero:cc.Node,heroBlood:cc.ProgressBar,powerBar:cc.ProgressBar,ideaBar:cc.ProgressBar,weapon:cc.Node,enemyBar:cc.ProgressBar,enemySpriteList:{default:[],type:[cc.SpriteFrame]},enemyType:cc.Node,bulletType:cc.Node},enemyLock:null,enemyNum:null,enemySpeed:null,timeStep:null,bulletNum:null,count:null,nextCount:null,onLoad:function(){this.bulletNum=20,this.timeLabel.string=0,this.timeStep=10,this.timeLabel.string+=this.timeStep,this.bulletLabel.string=this.bulletNum,this.levelLabel.string=1,this.scoreLabel.string=0,this.heroBlood.progress=1,this.powerBar.progress=1,this.enemySpeed=.5,this.enemyLock=!1,this.enemyNum=1,this.count=0,m.enemyVector=[],m.bulletVector=[],g.init(this.basic,this.touch),f.initSource(this.enemyType,this.bulletType,this,this.enemySpriteList)},start:function(){this.pauseBtn.node.on("click",function(){this.current=cc.audioEngine.play(this.audio,!1,1),-300<this.pauseLayout.node.y?this.pauseLayout.node.getComponent(cc.Animation).play():this.pauseLayout.node.y+=694},this),this.backBtn.node.on("click",function(){this.current=cc.audioEngine.play(this.audio,!1,1),cc.director.loadScene("StartScene"),this.pauseLayout.node.y+=694},this),this.powerBtn.node.on("click",function(){if(0<m.enemyVector.length)var t=f.createBulletToEnemy(this.backgroundLayer.convertToNodeSpace(this.weapon),this.backgroundLayer,m.enemyVector);else t=f.createBullet(this.weapon,this.backgroundLayer);this.powerBar.progress-=1/this.bulletNum,m.bulletVector.push(t)},this),this.schedule(function(){this.enemyLock&&(this.timeLabel.string-=1,this.timeLabel.string<0&&(this.timeStep+=10,this.timeLabel.string=this.timeStep,this.enemySpeed+=.5,this.levelLabel.string+=1,this.enemyNum+=2))},1)},update:function(t){this.bulletLabel.string=parseInt(this.powerBar.progress*this.bulletNum),this.ideaLabel.string=parseInt(100*this.ideaBar.progress);var e=!0,o=!1,r=void 0;try{for(var n,i=m.bulletVector[Symbol.iterator]();!(e=(n=i.next()).done);e=!0)for(var c=n.value,a=0;a<m.enemyVector.length;a++){var s=m.enemyVector[a];v.testPos(c.position,s.position,30)&&(s.getChildByName("blood").getComponent(cc.ProgressBar).progress-=.2,this.current=cc.audioEngine.play(this.audio,!1,1),s.getChildByName("blood").getComponent(cc.ProgressBar).progress<.05&&(s.destroy(),m.enemyVector.splice(a,1),a-=1,this.scoreLabel.string+=1))}}catch(t){o=!0,r=t}finally{try{!e&&i.return&&i.return()}finally{if(o)throw r}}!0===g.getStatus()?this.weapon.rotation=-b.transformAngle(g.getMoveAngle()):this.weapon.rotation=-b.transformAngle(g.getLastAngle()),this.backgroundLayer.x<300&&(this.noticeLabel.node.removeFromParent(!1),this.enemyLock=!0),60<this.count&&(this.ideaBar.progress-=.005,this.powerBar.progress+=.005,1<this.powerBar.progress&&(this.powerBar.progress=1)),this.enemyLock&&(this.count+=1,!0===g.getStatus()&&(this.count=0,this.ideaBar.progress<=1&&(this.ideaBar.progress+=.005)),f.createAmaryInVectorAuto(m.enemyVector,this.backgroundLayer,this.enemyNum,b.getRandPos(cc.p(600,316.8),cc.p(-300,-158.4))),y.faceToNearestTarget(this.weapon,b.getPosNegative(this.backgroundLayer.position),m.enemyVector)),y.faceTargetByAngle(this.weapon.rotation,this.hero.getChildByName("spr")),g.updateCamera(this.backgroundLayer),(this.heroBlood.progress<.01||this.bulletLabel.string<0||this.ideaBar.progress<.01)&&(m.score=this.scoreLabel.string,m.level=this.levelLabel.string,cc.director.loadScene("OverScene"));var l=!0,u=!1,h=void 0;try{for(var p,d=m.enemyVector[Symbol.iterator]();!(l=(p=d.next()).done);l=!0){s=p.value;y.moveFollowTarget(s,b.getPosNegative(this.backgroundLayer.position),this.enemySpeed),y.faceTargetToX(b.getPosNegative(this.backgroundLayer.position),this.hero.getChildByName("spr"),s),v.testPos(b.getPosNegative(this.backgroundLayer.position),s.position,10)&&(this.heroBlood.progress-=.005,this.heroBloodLabel.string=parseInt(100*this.heroBlood.progress))}}catch(t){u=!0,h=t}finally{try{!l&&d.return&&d.return()}finally{if(u)throw h}}}}),cc._RF.pop()},{AnimationMediator:"AnimationMediator",BarManager:"BarManager",CollisionManager:"CollisionManager",EnemyFactory:"EnemyFactory",GlobalData:"GlobalData",MathVec:"MathVec",MoveCtrllor:"MoveCtrllor",SceneMediator:"SceneMediator"}],SceneMediator:[function(t,e,o){"use strict";cc._RF.push(e,"9d400G8LvpDOp0GSqvk5SMw","SceneMediator");var r={activeScene:null,initActiveScene:function(t){cc.director.loadScene(t),cc.director.getScene()},backtoStartScene:function(){PlayScene.active=!1,cc.director.loadScene("StartScene")},gotoPlayScene:function(){PlayScene.active=!0,cc.director.loadScene("PlayScene")},backtoPlayScene:function(){cc.director.loadScene("PlayScene")},gotoOverScene:function(){cc.director.loadScene("OverScene")}};e.exports=r,cc._RF.pop()},{}],StartScene:[function(t,e,o){"use strict";cc._RF.push(e,"9b537sOdDNLG7PQaEAbuNHH","StartScene");var r=t("AnimationMediator");cc.Class({extends:cc.Component,properties:{startBtn:cc.Button,backgroundSpr:cc.Sprite,audio:cc.AudioClip},bool:null,start:function(){this.bool=!0,this.startBtn.node.on("click",this.gotoPlayScene,this),this.schedule(function(){this.bool=!this.bool},1)},gotoPlayScene:function(){this.current=cc.audioEngine.play(this.audio,!1,1),cc.director.loadScene("PlayScene")},update:function(t){this.startBtn.node.active=this.bool,r.backgroundLoop(this.backgroundSpr.node,64)}}),cc._RF.pop()},{AnimationMediator:"AnimationMediator"}]},{},["AnimationMediator","BarManager","CollisionManager","EnemyFactory","GlobalData","JsTool","MathVec","MoveCtrllor","OverScene","PlayScene","SceneMediator","StartScene"]);